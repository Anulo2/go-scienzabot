kind: pipeline
name: default

workspace:
  base: /go
  path: src/scienzabot

steps:
- name: test
  image: golang
  commands:
  - go get
  - go test ./...
  
- name: build
  image: golang
  commands:
  - go build
  
- name: static analysis
  image: golang
  commands:
  - go get -u golang.org/x/lint/golint
  - go get github.com/mdempsky/maligned
  - golint .
  - go vet .
  - maligned ./...
  
- name: Container build
  image: golang
  commands:
  - CGO_ENABLED=1 GOOS=linux go build -a -ldflags '-extldflags "-static"' .
  
- name: Application deploy
  image: appleboy/drone-scp
  settings:
    host:
      from_secret: production_server_address
    username: 
      from_secret: production_server_username
    key: 
      from_secret: production_server_privatekey
    port: 22
    target: /root/scienzabot
    source: ./scienzabot
